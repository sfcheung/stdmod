---
title: "A Quick Start Guide on Using std_selected"
author: "Shu Fai Cheung"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{A Quick Start Guide on Using std_selected}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{magrittr}
---

```{r, include = FALSE}
options(width = 132)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width  =  6,
  fig.height =  6,
  fig.align = "center"
)
```

# Purpose

This guide demonstrates how to use `std_selected()` to:

- get the correct standardized regression coefficients of a moderated
regression model, and

- form the confidence intervals of the standardized regression coefficients
using nonparametric bootstrapping, that take into account the sampling variation
in standardization.

# Sample Dataset

```{r}
library(stdmod)
dat <- sleep_emo_con
head(dat, 3)
```

This dataset has 500 cases, with sleep duration (`sleep_duration`)
measured in average hours,
conscientiousness, emotional stability, age, and gender (a
string variable with two values: `"female"` and `"male"`).

For this illustration, we shorten the names of some variables for readability:

```{r}
colnames(dat)[2:4] <- c("sleep", "cons", "emot")
head(dat, 3)
```

# Model

Suppose this is the moderated regression model:

    - Dependent variable: sleep duration (`sleep`)
    - Independent variable: emotional stability (`emot`)
    - Moderator: conscientiousness (`cons`)
    - Control variable: `age` and `gender`.

`stats::lm()` can be used to fit this model:

```{r}
lm_out <- lm(sleep ~ age + gender + emot*cons,
             dat = dat)
summary(lm_out)
```

# Standardize Independent Variable and Moderator

## Refit the Model

Suppose we want to standardize only the two continuous psychological
variables, emotional stability and conscientiousness. Standardization
is equivalent to centering by mean and then scale by (divide by) standard
deviation. We can pass the `stats::lm()` output to `std_selected()`
and instruct the function to scale and center these two variables and
refit the moderated regression model:

```{r}
lm_std1 <- std_selected(lm_out,
                        to_scale = . ~ emot + cons,
                        to_center = . ~ emot + cons)
summary(lm_std1)
```

## Correct Nonparametric Bootstrapping Confidence Intervals

To request the correct nonparametric bootstrapping confidence intervals that
do standardization in each bootstrap sample, we can use `std_selected_boot()`:

```{r}
set.seed(870432)
lm_std1_boot <- std_selected_boot(lm_out,
                        to_scale = . ~ emot + cons,
                        to_center = . ~ emot + cons,
                        nboot = 100)
summary(lm_std1_boot)
```

# Standardize All Variables That Are Not Strings or Factors 

To standardize all variables that are not strings or factors, use `. ~ .`
for `to_scale` and `to_center`:

```{r}
set.seed(870432)
lm_std2_boot <- std_selected_boot(lm_out,
                        to_scale = . ~ .,
                        to_center = . ~ .,
                        nboot = 100)
summary(lm_std2_boot)
```
